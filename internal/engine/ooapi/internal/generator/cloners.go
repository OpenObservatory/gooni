package main

import (
	"fmt"
	"strings"
	"time"
)

func (d *Descriptor) genNewCloner(sb *strings.Builder) {
	fmt.Fprintf(sb, "// %s abstracts %s's cloner behavior.\n",
		d.ClonerInterfaceName(), d.APIStructName())
	fmt.Fprintf(sb, "type %s interface {\n", d.ClonerInterfaceName())
	fmt.Fprintf(sb, "\tWithToken(token string) %s\n", d.CallerInterfaceName())
	fmt.Fprint(sb, "}\n\n")
}

// GenClonersGo generates cloners.go.
func GenClonersGo() {
	var sb strings.Builder
	fmt.Fprint(&sb, "// Code generated by go generate; DO NOT EDIT.\n")
	fmt.Fprintf(&sb, "// %s\n\n", time.Now())
	fmt.Fprint(&sb, "package ooapi\n\n")
	fmt.Fprint(&sb, "//go:generate go run ./internal/generator\n\n")
	for _, desc := range Descriptors {
		if !desc.RequiresLogin {
			continue
		}
		desc.genNewCloner(&sb)
	}
	writefile("cloners.go", &sb)
}
